<div
  class="fixed inset-0 bg-slate-900/60 dark:bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 transition-all duration-300 px-4">

  <div
    class="bg-white dark:bg-slate-800 rounded-[2rem] shadow-2xl w-full max-w-lg p-8 relative border border-white/20 dark:border-slate-700 transform transition-all scale-100">

    <button class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors"
      (click)="closeModal()">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <div class="mb-8">
      <h2 class="text-2xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
        <span class="p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
          <svg class="w-6 h-6 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <path d="M14 2v6h6" />
            <path d="M16 13H8M16 17H8M10 9H8" />
          </svg>
        </span>
        {{ 'employment_letter.title' | translate }}
      </h2>
      <p class="text-sm text-gray-500 dark:text-slate-400 mt-2">
       {{ 'employment_letter.subtitle' | translate }}
     </p>
    </div>

    <form class="space-y-6">
      <div>
        <label class="block text-[11px] font-black uppercase text-gray-400 dark:text-slate-500 mb-2 ml-1 tracking-widest">
         {{ 'employment_letter.select_language_label' | translate }}
        </label>
      
        <div class="relative">
          <button type="button" (click)="langOpen = !langOpen"
            class="flex h-14 w-full items-center justify-between rounded-2xl border border-gray-100 dark:border-slate-700 bg-gray-50 dark:bg-slate-900 px-5 text-sm font-bold text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 transition-all shadow-sm">
      
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-globe text-blue-500 text-base"></i>
              <span>
                 {{
                  selectedLanguage
                    ? (('employment_letter.languages.' + selectedLanguage) | translate)
                    : ('employment_letter.select_language_placeholder' | translate)
                }}
              </span>
            </div>
      
            <i class="fa-solid fa-chevron-down text-xs text-gray-400 transition-transform duration-300"
              [class.rotate-180]="langOpen"></i>
          </button>
      
          <div *ngIf="langOpen"
            class="absolute left-0 right-0 z-[9999] mt-2 overflow-hidden rounded-[1.5rem] border border-gray-100 dark:border-slate-700 bg-white dark:bg-slate-800 shadow-2xl animate-in fade-in zoom-in-95 duration-200">
      
            <div class="py-2">
              <button type="button" (click)="selectLanguage('English')" class="flex w-full items-center gap-3 px-5 py-4 text-left text-sm font-bold transition-all
                      hover:bg-blue-50 dark:hover:bg-slate-700/50 group">
                <span
                  class="w-8 h-8 rounded-full bg-gray-100 dark:bg-slate-900 flex items-center justify-center text-xs group-hover:bg-blue-100 dark:group-hover:bg-blue-900/40">ðŸ‡ºðŸ‡¸</span>
                <span
                  class="text-gray-700 dark:text-slate-300 group-hover:text-blue-700 dark:group-hover:text-white">  
                  {{ 'employment_letter.languages.English' | translate }}
                </span>
                <i *ngIf="selectedLanguage === 'English'" class="fa-solid fa-check ml-auto text-blue-500"></i>
              </button>
      
              <button type="button" (click)="selectLanguage('Arabic')" class="flex w-full items-center gap-3 px-5 py-4 text-left text-sm font-bold transition-all
                      hover:bg-blue-50 dark:hover:bg-slate-700/50 group border-t border-gray-50 dark:border-slate-700/50">
                <span
                  class="w-8 h-8 rounded-full bg-gray-100 dark:bg-slate-900 flex items-center justify-center text-xs group-hover:bg-blue-100 dark:group-hover:bg-blue-900/40">ðŸ‡ªðŸ‡¬</span>
                <span
                  class="text-gray-700 dark:text-slate-300 group-hover:text-blue-700 dark:group-hover:text-white">
                 {{ 'employment_letter.languages.Arabic' | translate }}
                </span>
                <i *ngIf="selectedLanguage === 'Arabic'" class="fa-solid fa-check ml-auto text-blue-500"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div>
        <label class="block text-sm font-bold text-gray-700 dark:text-slate-300 mb-2 ml-1 uppercase tracking-wider">
           {{ 'employment_letter.directed_to_label' | translate }}
        </label>
        <div class="relative">
          <input #target type="text" readonly [value]="directedTo" placeholder="e.g. Banque Misr, Embassy of France"
            (focus)="keyboardVisibleTarget = true" (blur)="hideKeyboardTarget()"
            class="w-full rounded-xl bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 px-4 py-3 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-slate-600" />
      
          <div *ngIf="keyboardVisibleTarget"
            class="absolute left-0 right-0 z-[50] mt-2 p-2 bg-gray-100 dark:bg-slate-800 rounded-xl shadow-2xl border dark:border-slate-700">
            <app-virtual-keyboard mode="letters" (keyPress)="appendKey('directedTo', $event)"
              (backspace)="backspace('directedTo')" (clear)="clearInput('directedTo')">
            </app-virtual-keyboard>
          </div>
        </div>
      </div>

      <div class="flex items-center justify-end gap-3 pt-6">
        <button type="button"
          class="px-6 py-3 font-semibold text-gray-600 dark:text-slate-400 hover:text-gray-800 dark:hover:text-white transition-colors"
          (click)="closeModal()">
          {{ 'employment_letter.cancel' | translate }}
        </button>

        <button type="button"
          class="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-500 dark:to-indigo-500 text-white font-bold rounded-xl shadow-lg shadow-blue-200 dark:shadow-none hover:scale-[1.02] active:scale-95 transition-all"
          (click)="onSubmit(selectedLanguage, target.value)">
          {{ 'employment_letter.submit' | translate }}
        </button>
      </div>
    </form>
  </div>
</div>